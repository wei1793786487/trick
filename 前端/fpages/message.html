<!DOCTYPE html>
<html lang="zh">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>网上售票系统</title>
	<link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css" />
	<link rel="stylesheet" type="text/css" href="../css/index.css" /><!-- 全局css -->
	<link rel="stylesheet" href="../css/banner.css"><!-- banner 轮播界面引用css -->
	<link rel="stylesheet" type="text/css" href="../css/ticket.css" />
</head>

<body>
	<div class="container-fluid">
		<div class="container">
			<div class="row top">
				<div class="logo col-md-4">
					<img src="../images/logo.png">
					<span>
						网上售票系统
					</span>
				</div>
				<div class="dh col-md-8">
					<div class="container-fluid">
						<div class="row">
							<div class="topList col-md-2"><a href="index.html">主页</a></div>
							<div class="topList col-md-2"><a href="detail.html">留言界面</a></div>
							<div class="topList col-md-2"><a href="message.html">票务管理</a></div>

							<div id="nologin" style="display: none;" class="topList col-md-2"><a
									href="register.html">您没有登录，请登录</a>
							</div>
							<div id="islogin" style="display: none;" class="topList col-md-2"><a><span
										id="uname"></span>，您好</a>

							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- 头部引用结束 -->
	<!-- 面包屑 -->
	<div class="container-fluid" style="background-color: #f5f5f5;">
		<div class="breadcrumb">
			当前位置：<a href="./index.html">返回首页</a>
		</div>
	</div>
	<!-- 面包屑 -->
	<div class="container list">
		<div class="row">
			<div class="col-md-3 listLeft">
				<div class="col-md-12 leftBtn" id="leftBtn1"><a href="#">
						<h3>购买详情</h3>
					</a></div>

			</div>
			<div class="col-md-8 listRight">
				<div class="col-md-12">
					<div class="center-main">
						<!-- 切换卡 -->
						<div class="wrap" id="wrap1" style="display: block;">
							<div class="dowebok-header">
								<label for="listCard-1-trigger" id="a">购买详情</label>
							</div>

							<input id="listCard-1-trigger" type="radio" name="listCards1" checked>
							<div class="listCard listCard-one">
								<form>
									<!-- 订单-->
									<div class="subway-order">
										<div class="panel-tab" style="border-bottom: 1px solid #dedede;">
											<!-- 售票信息 -->
											<table class="title-text table table-bordered">
												<tr>
													<th>
														<h5>车次名称</h5>
													</th>
													<th>
														<h5>发车时间</h5>
													</th>

													<th>
														<h5>出发地点</h5>
													</th>
													<th>
														<h5>到达地点</h5>
													</th>
													<th>
														<h5>操作</h5>
													</th>

												</tr>
											</table>

											<span id="note">

											</span>


										</div>
									</div>
									<!-- 订单 -->
								</form>


								<!-- 提醒 -->
							</div>

							<input id="listCard-2-trigger" type="radio" name="listCards1">
							<div class="listCard listCard-two">
								<form class="form-horizontal  ">
									<div class="form-group form-group-sm">
										<label for="inputPassword3" class="col-sm-2 control-label">
											<h5 style="color: #000000;">使用身份证查询</h5>
										</label>
										<div class="col-sm-7">
											<input type="search" class="form-control" id="search"
												placeholder="请输入个人身份证">
										</div>
									</div>
									<div class="form-group">
										<div class="col-sm-offset-3 col-sm-5">
											<button type="submit" class="btn btn-primary btn-lg btn-block">确定</button>
										</div>
									</div>
								</form>
							</div>
						</div>
					</div>
					<!-- 销售小卡片 -->

				</div>
			</div>
		</div>
	</div>
	</div>
	</div>

	</div>
	<!-- 底部版权区 -->
	<div class="container-fluid">
		<div class="row bottom">
			<div class="bottomCenter col-md-6 col-md-offset-3">
				<span>© 2020 成辉公司  &nbsp;  <a href="">隐私政策</a> &nbsp;  京ICP证066666x号 京ICP备100066666号</span>
		</div>
	</div>

	<script src="../js/jquery.min.js"></script>
	<script src="../js/jquery.easyfader.min.js"></script>
	<script src="../lib/layui-v2.5.4/layui.js" charset="utf-8"></script>
	<script src="../network/network.js" charset="utf-8"></script>
	<script src="../js/p-ajax.js" charset="utf-8"></script>
	<script src="../js/getParameter.js" charset="utf-8"></script>
	<script src="../js/cookieUtils.js" charset="utf-8"></script>
	<script src="../js/common.js" charset="utf-8"></script>

	<script>
		layui.use(["layer"], function () {
			layer = layui.layer;

			getorder().then(res => {
				let data = res.data

				console.log(res)
				let d = ""
				for (i = 0; i < data.length; i++) {
					let id = data[i].id;
					let name = data[i].ticketing.trainName;
					let stime = data[i].ticketing.stime;
					let saddress = data[i].ticketing.saddress;
					let eaddress = data[i].ticketing.eaddress;


					//接下来就是激动人心的字符串拼接
					let m = '<table class="title-text table table-condensed table-hover">' +
						'<th style="display: none;">' +
						'<h5>' + id + '</h5' +
						'</th>' +
						'<th>' +
						'<h5>' + name + '</h5>' +
						'	</th>' +
						'	<th>' +
						'<h5>' + stime + '</h5>' +
						'</th>' +
						'<th>' +
						'	<h5>' + saddress + '</h5>' +
						'</th>' +
						'<th>' +
						'	<h5>' + eaddress + '</h5>' +
						'</th>' +
						'<th>' +
						'<a class="btn btn-default" href="#" role="button">退票</a>' +
						'<a class="btn btn-default" href="#" role="button">换票</a>' +
						'	</th>' +
						'	</table>'

					d += m;
				}
				$("#note").html(d);

				$(".btn").click(function () {
					var id = $(this).parents("tr").children("th").children("h5").first().html();
					console.log()
					if ($(this).text() === "换票") {
						layer.prompt({
							title: '请输入你要退换的车次'
						}, function (pass, index) {


							findTrickByname(pass).then(res => {
								console.log(res)
								if (res.code === 200) {
									let nid = res.data.id;
									layer.close(index);
									layer.msg('此操作要扣除5%的手续费，您确定吗?', {
										time: 0 //不自动关闭
										,
										btn: ['确定', '取消'],
										yes: function (index) {
											layer.close(index);
											chance_order(id, nid).then(
												res => {
													if (res.code ===
														200) {
														layer.msg(
															"换票成功" +
															res
																.data, {
															time: 1000,
														});
													} else {
														layer.msg(res
															.message, {
															time: 1000,
															icon: 2
														})
													}
												})
										}
									});

								} else {
									layer.msg(res.message, {
										time: 1000,

									})
								}

							})


						});

					} else if ($(this).text() === "退票") {
						console.log(data)
						delete_order([id]).then(res => {
							if (res.code === 200) {
								layer.msg("退票成功,返还给你"+res.data+"元", {
									time: 1000,
								}, function () {
									location.reload();
								});

							} else {
								layer.msg(res.message, {
									time: 1000,
									icon: 2
								})
							}
						})

					}
					return false;
				})
			})
		});
	</script>
</body>

</html>